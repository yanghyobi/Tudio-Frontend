import React, { useState } from 'react';
import { 
  ShieldCheck, Search, Calendar, ChevronRight, Download,
  Monitor, Smartphone, Globe, AlertCircle, CheckCircle2, FileSpreadsheet
} from 'lucide-react';

// 1. ìƒ˜í”Œ ë°ì´í„° (JSPì˜ items="${logList}" ëŒ€ì‘)
const MOCK_LOGS = [
  { id: 1, time: '2025-12-19 14:32:01', user: 'ê¹€ê´€ë¦¬ (admin)', ip: '192.168.0.5', os: 'Windows 10', browser: 'Chrome', status: 'success', reason: '' },
  { id: 2, time: '2025-12-19 14:10:15', user: 'ì´ì˜í¬ (young)', ip: '211.55.23.11', os: 'Mac OS', browser: 'Safari', status: 'success', reason: '' },
  { id: 3, time: '2025-12-19 13:55:00', user: 'ë°•ì§€ë¯¼ (park)', ip: '118.33.10.55', os: 'Windows 11', browser: 'Edge', status: 'fail', reason: 'ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜' },
  { id: 4, time: '2025-12-19 09:00:22', user: 'í™ê¸¸ë™ (hong)', ip: '172.16.10.1', os: 'Android', browser: 'Mobile App', status: 'success', reason: '' },
  { id: 5, time: '2025-12-18 18:20:11', user: 'ìµœì¤€ì˜ (choi)', ip: '58.123.45.67', os: 'iOS', browser: 'Mobile Safari', status: 'fail', reason: 'ê³„ì • ì ê¸ˆ' },
];

const LogLogin = () => {
  const [logs, setLogs] = useState(MOCK_LOGS);
  
  // ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸° (ê²€ìƒ‰ í•„í„° ì´ˆê¸°ê°’ìš©)
  const today = new Date().toISOString().split('T')[0];
  const [searchParams, setSearchParams] = useState({
    startDate: today,
    endDate: today,
    condition: 'id',
    keyword: '',
    status: 'all'
  });

  // ê²€ìƒ‰ í•¸ë“¤ëŸ¬
  const handleSearch = () => {
    alert('ê²€ìƒ‰ ê¸°ëŠ¥ì€ ì„œë²„ APIì™€ ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.\n(í˜„ì¬ëŠ” ë°ëª¨ ë°ì´í„°ë§Œ í‘œì‹œë©ë‹ˆë‹¤.)');
  };

  // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ í•¸ë“¤ëŸ¬
  const handleDownload = () => {
    if(window.confirm(`í˜„ì¬ ê²€ìƒ‰ëœ ${logs.length}ê±´ì˜ ë¡œê·¸ë¥¼ ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        alert('ì—‘ì…€ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  };

  // OS ì•„ì´ì½˜ í—¬í¼
  const getOsIcon = (os) => {
    if (os.toLowerCase().includes('windows') || os.toLowerCase().includes('mac')) return <Monitor size={14}/>;
    if (os.toLowerCase().includes('android') || os.toLowerCase().includes('ios')) return <Smartphone size={14}/>;
    return <Globe size={14}/>;
  };

  return (
    <div className="flex-grow-1 p-5 d-flex flex-column h-100">
      
      {/* 1. Breadcrumb & Header */}
      <div className="mb-4">
        <nav className="text-muted small mb-2 d-flex align-items-center gap-2">
          <span>Admin</span> <ChevronRight size={12} /> 
          <span>ë¡œê·¸ ê´€ë¦¬</span> <ChevronRight size={12} />
          <span className="text-primary fw-bold">ë¡œê·¸ì¸ ë¡œê·¸</span>
        </nav>
        <h2 className="fw-bold text-dark m-0 d-flex align-items-center gap-2">
          <ShieldCheck size={24} className="text-primary" /> ë¡œê·¸ì¸ ì´ë ¥ ì¡°íšŒ
        </h2>
      </div>

      {/* 2. ê²€ìƒ‰ í•„í„° ì˜ì—­ (ìƒë‹¨ ì¹´ë“œ) */}
      <div className="card border-0 shadow-sm rounded-3 mb-4 bg-white">
        <div className="card-body bg-light rounded-3 p-4">
            <div className="row g-3 align-items-end">
                <div className="col-md-4">
                    <label className="form-label fw-bold small text-muted">ì¡°íšŒ ê¸°ê°„</label>
                    <div className="input-group">
                        <input 
                            type="date" 
                            className="form-control" 
                            value={searchParams.startDate}
                            onChange={(e) => setSearchParams({...searchParams, startDate: e.target.value})}
                        />
                        <span className="input-group-text bg-white border-start-0 border-end-0">~</span>
                        <input 
                            type="date" 
                            className="form-control"
                            value={searchParams.endDate}
                            onChange={(e) => setSearchParams({...searchParams, endDate: e.target.value})}
                        />
                    </div>
                </div>
                
                <div className="col-md-2">
                    <label className="form-label fw-bold small text-muted">ê²€ìƒ‰ ì¡°ê±´</label>
                    <select className="form-select" onChange={(e) => setSearchParams({...searchParams, condition: e.target.value})}>
                        <option value="id">ì•„ì´ë””</option>
                        <option value="name">ì´ë¦„</option>
                        <option value="ip">ì ‘ì† IP</option>
                    </select>
                </div>
                <div className="col-md-3">
                    <label className="form-label fw-bold small text-muted">ê²€ìƒ‰ì–´</label>
                    <input 
                        type="text" 
                        className="form-control" 
                        placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        value={searchParams.keyword}
                        onChange={(e) => setSearchParams({...searchParams, keyword: e.target.value})}
                    />
                </div>

                <div className="col-md-2">
                    <label className="form-label fw-bold small text-muted">ë¡œê·¸ì¸ ìƒíƒœ</label>
                    <select className="form-select" onChange={(e) => setSearchParams({...searchParams, status: e.target.value})}>
                        <option value="all">ì „ì²´</option>
                        <option value="success">ì„±ê³µ</option>
                        <option value="fail">ì‹¤íŒ¨</option>
                    </select>
                </div>

                <div className="col-md-1">
                    <button type="button" className="btn btn-primary w-100" onClick={handleSearch}>
                        <Search size={18} />
                    </button>
                </div>
            </div>
        </div>
      </div>

      {/* 3. ë¦¬ìŠ¤íŠ¸ ì˜ì—­ (í•˜ë‹¨ ì¹´ë“œ) */}
      <div className="flex-grow-1 card border-0 shadow-sm rounded-3 overflow-hidden d-flex flex-column bg-white">
        
        {/* ì¹´ë“œ í—¤ë” */}
        <div className="p-3 border-bottom d-flex justify-content-between align-items-center bg-white">
           <div>
             <h5 className="fw-bold mb-1">ğŸ“‹ ë¡œê·¸ì¸ ì´ë ¥ ëª©ë¡</h5>
             <small className="text-muted">
                ì´ <span className="text-primary fw-bold">{logs.length}</span>ê±´ì˜ ë¡œê·¸ê°€ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤. 
                (ë¡œê·¸ ë³´ê´€ ê¸°ê°„: <span className="text-danger fw-bold">6ê°œì›”</span>)
             </small>
           </div>
           <button className="btn btn-success btn-sm d-flex align-items-center gap-2 fw-bold px-3" onClick={handleDownload}>
             <FileSpreadsheet size={16}/> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
           </button>
        </div>

        {/* í…Œì´ë¸” */}
        <div className="table-responsive flex-grow-1">
          <table className="table table-hover align-middle mb-0">
            <thead className="bg-light text-muted small text-uppercase">
              <tr>
                <th className="text-center py-3" style={{width:'60px'}}>No</th>
                <th className="ps-3 py-3">ì ‘ì† ì¼ì‹œ</th>
                <th className="py-3">ì‚¬ìš©ì (ID)</th>
                <th className="py-3">ì ‘ì† IP</th>
                <th className="py-3">OS / ë¸Œë¼ìš°ì €</th>
                <th className="text-center py-3">ìƒíƒœ</th>
                <th className="py-3">ë¹„ê³  (ì‹¤íŒ¨ ì‚¬ìœ )</th>
              </tr>
            </thead>
            <tbody>
              {logs.map((log) => (
                <tr key={log.id}>
                  <td className="text-center text-muted small">{log.id}</td>
                  <td className="ps-3 text-muted small number-font">{log.time}</td>
                  <td className="fw-bold text-dark">{log.user}</td>
                  <td className="text-secondary small number-font">{log.ip}</td>
                  <td>
                    <div className="d-flex align-items-center gap-2 small text-muted">
                       {getOsIcon(log.os)}
                       {log.os} / {log.browser}
                    </div>
                  </td>
                  <td className="text-center">
                    {log.status === 'success' ? (
                      <span className="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 rounded-pill px-3">
                        <CheckCircle2 size={12} className="me-1"/> ì„±ê³µ
                      </span>
                    ) : (
                      <span className="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 rounded-pill px-3">
                        <AlertCircle size={12} className="me-1"/> ì‹¤íŒ¨
                      </span>
                    )}
                  </td>
                  <td className="text-muted small">
                    {log.status !== 'success' ? <span className="text-danger">{log.reason}</span> : '-'}
                  </td>
                </tr>
              ))}
              {logs.length === 0 && (
                <tr>
                    <td colSpan="7" className="text-center py-5 text-muted">
                        <div className="d-flex flex-column align-items-center">
                            <AlertCircle size={40} className="text-muted mb-2 opacity-50"/>
                            <span>ê²€ìƒ‰ëœ ë¡œê·¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
                        </div>
                    </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>

        {/* í˜ì´ì§€ë„¤ì´ì…˜ */}
        <div className="p-3 border-top bg-white d-flex justify-content-center">
           <nav>
             <ul className="pagination pagination-sm mb-0">
               <li className="page-item disabled"><a className="page-link" href="#">ì´ì „</a></li>
               <li className="page-item active"><a className="page-link" href="#">1</a></li>
               <li className="page-item"><a className="page-link" href="#">2</a></li>
               <li className="page-item"><a className="page-link" href="#">3</a></li>
               <li className="page-item"><a className="page-link" href="#">4</a></li>
               <li className="page-item"><a className="page-link" href="#">5</a></li>
               <li className="page-item"><a className="page-link" href="#">ë‹¤ìŒ</a></li>
             </ul>
           </nav>
        </div>

      </div>
    </div>
  );
};

export default LogLogin;