import React, { useState } from 'react';
import { 
  ClipboardList, Search, Plus, Calendar, 
  Users, BarChart2, ChevronRight, CheckCircle2, Clock
} from 'lucide-react';

// 1. 샘플 데이터
const MOCK_SURVEYS = [
  { id: 2, title: '2025년 상반기 서비스 만족도 조사', status: 'ongoing', responses: 1240, startDate: '2025-01-01', endDate: '2025-01-31', writer: '관리자1' },
  { id: 1, title: '신규 기능(AI 챗봇) 도입에 대한 의견 조사', status: 'closed', responses: 532, startDate: '2024-11-01', endDate: '2024-11-15', writer: '관리자1' },
  { id: 3, title: '사내 복지 제도 개선 설문', status: 'ongoing', responses: 45, startDate: '2025-01-05', endDate: '2025-02-05', writer: '관리자3' },
  { id: 4, title: '겨울 시즌 이벤트 선호도 조사', status: 'closed', responses: 890, startDate: '2024-12-01', endDate: '2024-12-31', writer: '관리자2' },
];

const SurveyList = () => {
  const [surveys, setSurveys] = useState(MOCK_SURVEYS);
  const [activeTab, setActiveTab] = useState('all'); // 'all', 'ongoing', 'closed'
  const [searchTerm, setSearchTerm] = useState('');

  // 탭별 카운트 계산
  const count = {
    all: surveys.length,
    ongoing: surveys.filter(s => s.status === 'ongoing').length,
    closed: surveys.filter(s => s.status === 'closed').length,
  };

  // 필터링 로직 (탭 + 검색어)
  const filteredSurveys = surveys.filter(item => {
    const matchTab = activeTab === 'all' || item.status === activeTab;
    const matchSearch = item.title.includes(searchTerm);
    return matchTab && matchSearch;
  });

  const goCreate = () => {
    alert("SurveyForm 페이지로 이동합니다.");
  };

  return (
    <div className="flex-grow-1 p-5 d-flex flex-column h-100">
      
      {/* 헤더 */}
      <div className="mb-4">
        <nav className="text-muted small mb-2 d-flex align-items-center gap-2">
          <span>Admin</span> <ChevronRight size={12} /> 
          <span>설문 관리</span> <ChevronRight size={12} />
          <span className="text-primary fw-bold">설문 목록</span>
        </nav>
        <div className="d-flex justify-content-between align-items-end">
          <h2 className="fw-bold text-dark m-0 d-flex align-items-center gap-2">
            <ClipboardList size={24} className="text-primary" /> 설문 조사 관리
          </h2>
          <button className="btn btn-primary fw-bold px-4 d-flex align-items-center gap-2" onClick={goCreate}>
            <Plus size={18} /> 새 설문 만들기
          </button>
        </div>
      </div>

      {/* 메인 컨텐츠 카드 */}
      <div className="flex-grow-1 card border-0 shadow-sm rounded-3 overflow-hidden bg-white d-flex flex-column">
        
        {/* 1. 상단 탭 & 검색 영역 */}
        <div className="border-bottom px-4 pt-3 bg-white">
          <div className="d-flex justify-content-between align-items-center mb-0">
            
            {/* 탭 메뉴 */}
            <ul className="nav nav-tabs border-0" style={{ marginBottom: '-1px' }}>
              <li className="nav-item">
                <button 
                  className={`nav-link px-3 pb-3 border-0 fw-bold ${activeTab === 'all' ? 'active border-bottom border-primary text-primary' : 'text-muted'}`}
                  style={{ borderBottomWidth: '3px !important' }}
                  onClick={() => setActiveTab('all')}
                >
                  전체 ({count.all})
                </button>
              </li>
              <li className="nav-item">
                <button 
                  className={`nav-link px-3 pb-3 border-0 fw-bold ${activeTab === 'ongoing' ? 'active border-bottom border-primary text-primary' : 'text-muted'}`}
                  style={{ borderBottomWidth: '3px !important' }}
                  onClick={() => setActiveTab('ongoing')}
                >
                  진행중 ({count.ongoing})
                </button>
              </li>
              <li className="nav-item">
                <button 
                  className={`nav-link px-3 pb-3 border-0 fw-bold ${activeTab === 'closed' ? 'active border-bottom border-primary text-primary' : 'text-muted'}`}
                  style={{ borderBottomWidth: '3px !important' }}
                  onClick={() => setActiveTab('closed')}
                >
                  종료 ({count.closed})
                </button>
              </li>
            </ul>

            {/* 검색창 (오른쪽 배치) */}
            <div className="input-group input-group-sm mb-2" style={{ width: '250px' }}>
              <span className="input-group-text bg-light border-end-0"><Search size={14}/></span>
              <input 
                type="text" 
                className="form-control bg-light border-start-0" 
                placeholder="설문 제목 검색" 
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
            </div>
          </div>
        </div>

        {/* 2. 설문 리스트 테이블 */}
        <div className="table-responsive flex-grow-1">
          <table className="table table-hover align-middle mb-0">
            <thead className="bg-light text-muted small text-uppercase">
              <tr>
                <th className="text-center py-3" style={{width:'60px'}}>No</th>
                <th className="text-center" style={{width:'100px'}}>상태</th>
                <th className="py-3 ps-3">설문 제목</th>
                <th className="text-center" style={{width:'150px'}}>참여 인원</th>
                <th className="text-center" style={{width:'220px'}}>설문 기간</th>
                <th className="text-center" style={{width:'100px'}}>작성자</th>
                <th className="text-center" style={{width:'100px'}}>결과</th>
              </tr>
            </thead>
            <tbody>
              {filteredSurveys.map((survey) => (
                <tr key={survey.id}>
                  <td className="text-center text-muted small">{survey.id}</td>
                  <td className="text-center">
                    {survey.status === 'ongoing' ? (
                      <span className="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 rounded-pill px-3 d-inline-flex align-items-center gap-1">
                        <Clock size={12}/> 진행중
                      </span>
                    ) : (
                      <span className="badge bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25 rounded-pill px-3 d-inline-flex align-items-center gap-1">
                        <CheckCircle2 size={12}/> 종료됨
                      </span>
                    )}
                  </td>
                  <td className="ps-3">
                    <span className="fw-bold text-dark d-block text-truncate" style={{maxWidth: '450px'}}>{survey.title}</span>
                  </td>
                  <td className="text-center">
                    <div className="d-flex align-items-center justify-content-center gap-1 text-dark fw-bold">
                      <Users size={14} className="text-muted"/> {survey.responses.toLocaleString()}
                    </div>
                  </td>
                  <td className="text-center text-muted small">
                    <div className="d-flex align-items-center justify-content-center gap-1">
                      <Calendar size={14}/> {survey.startDate} ~ {survey.endDate}
                    </div>
                  </td>
                  <td className="text-center text-muted small">{survey.writer}</td>
                  <td className="text-center">
                    <button className="btn btn-sm btn-white border shadow-sm" onClick={() => alert('결과 통계 페이지로 이동')} title="통계 보기">
                      <BarChart2 size={16} className="text-secondary" />
                    </button>
                  </td>
                </tr>
              ))}
              {filteredSurveys.length === 0 && (
                <tr><td colSpan="7" className="text-center py-5 text-muted">해당하는 설문이 없습니다.</td></tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

export default SurveyList;