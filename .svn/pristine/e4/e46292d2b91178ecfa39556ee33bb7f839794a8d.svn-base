import React, { useState } from 'react';
import { 
  MessageCircle, List, ChevronRight, 
  Search, User, Calendar, Send, Trash2, 
  CheckSquare, AlertCircle
} from 'lucide-react';

// 1. ìƒ˜í”Œ ë°ì´í„° (HTMLì— ìˆë˜ ë‚´ìš© ê·¸ëŒ€ë¡œ ì ìš©)
const MOCK_INQUIRIES = [
  { 
    id: 1, 
    type: 'ì˜¤ë¥˜', 
    title: 'ë¡œê·¸ì¸ì´ ì•ˆë©ë‹ˆë‹¤', 
    writer: 'ê¹€ì² ìˆ˜', 
    date: '2025-12-19', 
    status: 'waiting', 
    content: 'ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ ë°˜ì‘ì´ ì—†ìŠµë‹ˆë‹¤. í¬ë¡¬ ë¸Œë¼ìš°ì € ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.', 
    answer: '' 
  },
  { 
    id: 2, 
    type: 'ê¸°íƒ€', 
    title: 'ê¸°ëŠ¥ ì œì•ˆí•©ë‹ˆë‹¤', 
    writer: 'ì´ì˜í¬', 
    date: '2025-12-18', 
    status: 'completed', 
    content: 'ì•ˆë…•í•˜ì„¸ìš”, Tudio ì‚¬ìš© ì¤‘ ê±´ì˜ì‚¬í•­ì´ ìˆì–´ ë‚¨ê¹ë‹ˆë‹¤.\nëŒ€ì‹œë³´ë“œ í™”ë©´ì—ì„œ ë‹¤í¬ëª¨ë“œë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ì»¬ëŸ¬ í…Œë§ˆë¥¼ ì„ íƒí•  ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.', 
    answer: 'ì•ˆë…•í•˜ì„¸ìš”, ì´ì˜í¬ë‹˜.\nTudio ê´€ë¦¬ìì…ë‹ˆë‹¤.\n\në‚¨ê²¨ì£¼ì‹  ì†Œì¤‘í•œ ì˜ê²¬ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.\ní…Œë§ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê¸°ëŠ¥ì€ í˜„ì¬ ê°œë°œíŒ€ì—ì„œ ê¸ì •ì ìœ¼ë¡œ ê²€í†  ì¤‘ì¸ ì‚¬í•­ì´ë©°, ë‚´ë…„ ìƒë°˜ê¸° ì—…ë°ì´íŠ¸ì— ë°˜ì˜ë  ìˆ˜ ìˆë„ë¡ ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤.' 
  }
];

const BoardInquiry = () => {
  // === State ===
  const [view, setView] = useState('list'); // 'list' | 'detail'
  const [posts, setPosts] = useState(MOCK_INQUIRIES);
  const [selectedPost, setSelectedPost] = useState(null);
  const [answerText, setAnswerText] = useState('');
  const [sendEmail, setSendEmail] = useState(false); // ì´ë©”ì¼ ë°œì†¡ ì²´í¬ ì—¬ë¶€

  // === Handlers ===
  
  // ìƒì„¸ í™”ë©´ìœ¼ë¡œ ì´ë™
  const goDetail = (post) => {
    setSelectedPost(post);
    setAnswerText(post.answer || '');
    setSendEmail(false); // ì´ˆê¸°í™”
    setView('detail');
  };

  // ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
  const goList = () => {
    setView('list');
    setSelectedPost(null);
    setAnswerText('');
  };

  // ë‹µë³€ ë“±ë¡/ìˆ˜ì •
  const handleSaveAnswer = () => {
    if (!answerText.trim()) return alert('ë‹µë³€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

    if (window.confirm(sendEmail ? 'ë‹µë³€ì„ ë“±ë¡í•˜ê³  ì´ë©”ì¼ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' : 'ë‹µë³€ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      const updatedPosts = posts.map(p => 
        p.id === selectedPost.id 
          ? { ...p, answer: answerText, status: 'completed' } 
          : p
      );
      setPosts(updatedPosts);
      setSelectedPost({ ...selectedPost, answer: answerText, status: 'completed' });
      
      alert(sendEmail ? 'ë‹µë³€ ë“±ë¡ ë° ì´ë©”ì¼ ë°œì†¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë‹µë³€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ì‚­ì œ
  const handleDelete = () => {
    if (window.confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      setPosts(posts.filter(p => p.id !== selectedPost.id));
      alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      goList();
    }
  };

  return (
    <div className="flex-grow-1 p-5 d-flex flex-column h-100">
      
      {/* 1. Breadcrumb & Header */}
      <div className="mb-4">
        <nav className="text-muted small mb-2 d-flex align-items-center gap-2">
          <span>Admin</span> <ChevronRight size={12} /> 
          <span>ê²Œì‹œíŒ ê´€ë¦¬</span> <ChevronRight size={12} />
          <span className="text-primary fw-bold">1:1 ë¬¸ì˜</span>
        </nav>
        <h2 className="fw-bold text-dark m-0 d-flex align-items-center gap-2">
          <MessageCircle size={24} className="text-primary" /> 
          {view === 'list' ? '1:1 ë¬¸ì˜ ê´€ë¦¬' : 'ë¬¸ì˜ ë‚´ìš© ìƒì„¸'}
        </h2>
      </div>

      {/* 2. Content Area (íšŒìƒ‰ ë°°ê²½ ìœ„ í°ìƒ‰ ì¹´ë“œ ìŠ¤íƒ€ì¼) */}
      
      {/* ==================== LIST VIEW ==================== */}
      {view === 'list' && (
        <div className="flex-grow-1 bg-white rounded-3 shadow-sm border overflow-hidden d-flex flex-column">
          <div className="p-3 border-bottom d-flex justify-content-between align-items-center bg-white">
             <h5 className="fw-bold mb-0 text-dark">ğŸ’¬ ë¬¸ì˜ ëª©ë¡</h5>
             <div className="d-flex gap-2">
                {/* ê²€ìƒ‰ í•„í„° ì˜ˆì‹œ */}
                <select className="form-select form-select-sm" style={{width:'120px'}}>
                    <option>ì „ì²´</option>
                    <option>ë‹µë³€ëŒ€ê¸°</option>
                    <option>ë‹µë³€ì™„ë£Œ</option>
                </select>
             </div>
          </div>
          
          <div className="table-responsive flex-grow-1">
            <table className="table table-hover align-middle mb-0">
              <thead className="bg-light text-muted small text-uppercase">
                <tr>
                  <th className="text-center py-3" style={{width:'80px'}}>ìœ í˜•</th>
                  <th className="ps-3 py-3">ì œëª©</th>
                  <th className="text-center" style={{width:'120px'}}>ì‘ì„±ì</th>
                  <th className="text-center" style={{width:'100px'}}>ìƒíƒœ</th>
                  <th className="text-center" style={{width:'120px'}}>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody>
                {posts.map(post => (
                  <tr key={post.id} style={{cursor:'pointer'}} onClick={() => goDetail(post)}>
                    <td className="text-center text-muted small">{post.type}</td>
                    <td className="ps-3">
                      <span className="fw-bold text-dark">{post.title}</span>
                    </td>
                    <td className="text-center text-muted small">{post.writer}</td>
                    <td className="text-center">
                      {post.status === 'waiting' ? (
                        <span className="badge bg-warning text-dark border border-warning">ëŒ€ê¸°</span>
                      ) : (
                        <span className="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25">ì™„ë£Œ</span>
                      )}
                    </td>
                    <td className="text-center">
                      <button 
                        className={`btn btn-sm px-3 fw-bold ${post.status === 'waiting' ? 'btn-primary' : 'btn-outline-secondary'}`}
                        onClick={(e) => {
                            e.stopPropagation(); // í–‰ í´ë¦­ ë°©ì§€
                            goDetail(post);
                        }}
                      >
                        {post.status === 'waiting' ? 'ë‹µë³€í•˜ê¸°' : 'ìƒì„¸ë³´ê¸°'}
                      </button>
                    </td>
                  </tr>
                ))}
                {posts.length === 0 && (
                    <tr><td colSpan="5" className="text-center py-5 text-muted">ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                )}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* ==================== DETAIL VIEW ==================== */}
      {view === 'detail' && selectedPost && (
        <div className="d-flex flex-column gap-4 h-100">
            
            {/* ìƒë‹¨: ì§ˆë¬¸ ë‚´ìš© ì¹´ë“œ */}
            <div className="card border-0 shadow-sm rounded-3 overflow-hidden">
                <div className="card-header bg-light py-3 px-4 d-flex justify-content-between align-items-center">
                    <div className="d-flex align-items-center gap-2">
                        <span className="badge bg-secondary">{selectedPost.type}</span>
                        <h5 className="fw-bold mb-0 m-0">{selectedPost.title}</h5>
                    </div>
                    {selectedPost.status === 'waiting' ? (
                        <span className="badge bg-warning text-dark fs-6">ë‹µë³€ ëŒ€ê¸°</span>
                    ) : (
                        <span className="badge bg-success fs-6">ë‹µë³€ ì™„ë£Œ</span>
                    )}
                </div>
                <div className="card-body p-4">
                    {/* ì‘ì„±ì ì •ë³´ */}
                    <div className="d-flex justify-content-between border-bottom pb-3 mb-3 text-muted small">
                        <div className="d-flex gap-3">
                            <span className="d-flex align-items-center gap-1"><User size={14}/> {selectedPost.writer}</span>
                            <span className="vr"></span>
                            <span className="d-flex align-items-center gap-1"><Calendar size={14}/> {selectedPost.date}</span>
                        </div>
                    </div>
                    {/* ë³¸ë¬¸ ë‚´ìš© */}
                    <div className="bg-light p-4 rounded border" style={{minHeight: '150px', whiteSpace: 'pre-line', lineHeight: '1.6'}}>
                        {selectedPost.content}
                    </div>
                </div>
            </div>

            {/* í•˜ë‹¨: ê´€ë¦¬ì ë‹µë³€ ì˜ì—­ (HTMLì˜ #section-board-inquiry-detail í•˜ë‹¨ ë¶€ë¶„) */}
            <div className="card border-primary border-2 shadow-sm rounded-3 flex-grow-1">
                <div className="card-header bg-primary bg-opacity-10 py-3 px-4">
                    <h5 className="fw-bold mb-0 text-primary d-flex align-items-center gap-2">
                        <MessageCircle size={20}/> ê´€ë¦¬ì ë‹µë³€
                    </h5>
                </div>
                <div className="card-body p-4 d-flex flex-column">
                    <label className="form-label fw-bold text-muted small">ë‹µë³€ ë‚´ìš© ì‘ì„±</label>
                    <textarea 
                        className="form-control mb-3 flex-grow-1" 
                        rows="5" 
                        placeholder="ë¬¸ì˜ì— ëŒ€í•œ ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
                        value={answerText}
                        onChange={(e) => setAnswerText(e.target.value)}
                        style={{resize:'none'}}
                    ></textarea>

                    <div className="d-flex justify-content-between align-items-center mt-auto pt-2">
                        <button className="btn btn-secondary px-4 d-flex align-items-center gap-2" onClick={goList}>
                            <List size={16}/> ëª©ë¡ìœ¼ë¡œ
                        </button>

                        <div className="d-flex align-items-center gap-2">
                            {/* ë‹µë³€ ëŒ€ê¸° ìƒíƒœì¼ ë•Œë§Œ 'ì´ë©”ì¼ ë°œì†¡' ì˜µì…˜ í‘œì‹œ */}
                            <div className="form-check d-flex align-items-center me-3">
                                <input 
                                    className="form-check-input me-2" 
                                    type="checkbox" 
                                    id="checkEmail" 
                                    checked={sendEmail}
                                    onChange={(e) => setSendEmail(e.target.checked)}
                                />
                                <label className="form-check-label small fw-bold" htmlFor="checkEmail">ë‹µë³€ ë“±ë¡ ì‹œ ì´ë©”ì¼ ë°œì†¡</label>
                            </div>

                            <button className="btn btn-outline-danger px-3 me-2" onClick={handleDelete}>
                                <Trash2 size={16}/> ì‚­ì œ
                            </button>

                            <button className="btn btn-primary px-4 fw-bold d-flex align-items-center gap-2" onClick={handleSaveAnswer}>
                                <Send size={16}/> {selectedPost.status === 'waiting' ? 'ë‹µë³€ ë“±ë¡' : 'ë‹µë³€ ìˆ˜ì •'}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
      )}

    </div>
  );
};

export default BoardInquiry;